---
phase: 04-polish-production
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/styles/globals.css
  - src/components/ui/AnimateOnScroll.tsx
autonomous: false

must_haves:
  truths:
    - "Users with prefers-reduced-motion see content instantly without animation"
    - "Lighthouse Performance score is 90+"
    - "Lighthouse Accessibility score is 95+"
    - "Production build has no console errors"
  artifacts:
    - path: "src/styles/globals.css"
      provides: "Reduced motion media query"
      contains: "prefers-reduced-motion"
    - path: "src/components/ui/AnimateOnScroll.tsx"
      provides: "Reduced motion detection in JS"
      contains: "prefers-reduced-motion"
  key_links:
    - from: "src/components/ui/AnimateOnScroll.tsx"
      to: "prefers-reduced-motion"
      via: "window.matchMedia check"
      pattern: "matchMedia.*prefers-reduced-motion"
---

<objective>
Ensure accessibility compliance for animations and verify production readiness with Lighthouse audits.

Purpose: Meet TECH-05 (90+ Performance), TECH-06 (95+ Accessibility), TECH-07 (no console errors), and respect user motion preferences.
Output: Reduced motion support, passing Lighthouse audits, verified production build.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-polish-production/04-CONTEXT.md
@.planning/phases/04-polish-production/04-RESEARCH.md
@.planning/phases/04-polish-production/04-01-SUMMARY.md

@src/styles/globals.css
@src/components/ui/AnimateOnScroll.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add reduced motion support</name>
  <files>
    src/styles/globals.css
    src/components/ui/AnimateOnScroll.tsx
  </files>
  <action>
1. Update `src/styles/globals.css` - add reduced motion media query after the body styles:
   ```css
   /* Respect user's motion preferences */
   @media (prefers-reduced-motion: reduce) {
     *,
     *::before,
     *::after {
       animation-duration: 0.01ms !important;
       animation-iteration-count: 1 !important;
       transition-duration: 0.01ms !important;
       scroll-behavior: auto !important;
     }
   }
   ```

2. Update `src/components/ui/AnimateOnScroll.tsx` to detect reduced motion preference:
   - Add useState for prefersReducedMotion (default false)
   - Add useEffect to check `window.matchMedia('(prefers-reduced-motion: reduce)').matches`
   - If reduced motion is preferred, render children without animation styles (just pass through)
   - This provides JS-level detection in addition to CSS-level blanket reduction

Example pattern:
```typescript
const [prefersReducedMotion, setPrefersReducedMotion] = useState(false)

useEffect(() => {
  setPrefersReducedMotion(
    window.matchMedia('(prefers-reduced-motion: reduce)').matches
  )
}, [])

// If reduced motion, show immediately without animation
const shouldAnimate = !prefersReducedMotion
const isVisible = !shouldAnimate || inView
```
  </action>
  <verify>
    - `npm run build` succeeds
    - In browser DevTools, enable "Reduce motion" in accessibility settings
    - Refresh page - content should appear instantly without fade/scale
    - Disable reduced motion - animations should work normally
  </verify>
  <done>
    - CSS media query disables all transitions for reduced motion users
    - AnimateOnScroll component detects and respects prefers-reduced-motion
    - Content always visible, just without animation when preference is set
  </done>
</task>

<task type="auto">
  <name>Task 2: Run Lighthouse audit and fix issues</name>
  <files>
    (varies based on audit findings)
  </files>
  <action>
1. Build the production version:
   ```bash
   npm run build
   ```

2. Serve the static export and run Lighthouse:
   ```bash
   npx serve out -p 3000
   ```
   Then in Chrome DevTools > Lighthouse tab, run audit for Performance + Accessibility.

   Alternatively, use Lighthouse CLI:
   ```bash
   npx lighthouse http://localhost:3000 --view
   ```

3. Record the scores:
   - Performance target: 90+
   - Accessibility target: 95+

4. If scores are below target, fix the issues Lighthouse identifies:

   **Common Performance fixes:**
   - Image optimization (already using unoptimized for static export - ensure images are WebP and appropriately sized)
   - Font loading (already using next/font with display: swap)
   - Unused CSS (Tailwind handles this via purging)

   **Common Accessibility fixes:**
   - Missing button accessible names
   - Color contrast issues
   - Missing form labels
   - Focus indicators

5. Re-run Lighthouse after fixes until targets are met.

6. Verify no console errors:
   ```bash
   # Check browser console on all pages
   # Check build output for warnings
   ```
  </action>
  <verify>
    - `npm run build` completes without errors
    - Production console has no errors on any page (/, /services, /about, /contact)
    - Lighthouse Performance >= 90
    - Lighthouse Accessibility >= 95
  </verify>
  <done>
    - Production build is clean with no errors
    - Lighthouse Performance score meets 90+ requirement
    - Lighthouse Accessibility score meets 95+ requirement
    - All console errors resolved
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete animations system with reduced motion support, production build with Lighthouse audit.
  </what-built>
  <how-to-verify>
    1. Run `npm run dev` and browse all pages
    2. Scroll through each page - headlines and CTAs should animate elegantly
    3. Hover over buttons - should lift with shadow
    4. In Chrome DevTools > Rendering > Emulate CSS media feature > prefers-reduced-motion: reduce
    5. Refresh - content should appear instantly without animation
    6. Disable reduced motion emulation
    7. Run `npm run build` and `npx serve out` to verify production build
    8. Check browser console on all pages - should be clean

    Optional: Run Lighthouse audit to confirm scores (Performance 90+, Accessibility 95+)
  </how-to-verify>
  <resume-signal>Type "approved" to confirm phase completion, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. Build succeeds: `npm run build` exits 0
2. No console errors on /, /services, /about, /contact pages
3. Lighthouse Performance >= 90
4. Lighthouse Accessibility >= 95
5. Reduced motion preference is respected (test in DevTools)
6. Animations still work when reduced motion is not set
</verification>

<success_criteria>
- prefers-reduced-motion users see content instantly (no animation)
- Lighthouse Performance score 90+
- Lighthouse Accessibility score 95+
- Production build has zero console errors
- User confirms visual polish meets expectations
</success_criteria>

<output>
After completion, create `.planning/phases/04-polish-production/04-02-SUMMARY.md`
</output>
